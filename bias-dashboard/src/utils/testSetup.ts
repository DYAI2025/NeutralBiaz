// Test setup and utilities for React Query integration testing\n\nimport { QueryClient } from '@tanstack/react-query';\nimport { rest } from 'msw';\nimport { setupServer } from 'msw/node';\nimport {\n  AnalysisResult,\n  BiasDetection,\n  BiasLevel,\n  BiasType,\n  HealthResponse,\n  ConfigResponse\n} from '../types/api';\n\n// Mock API endpoints\nconst API_BASE_URL = 'http://localhost:8000';\n\n// Sample test data\nexport const mockBiasDetection: BiasDetection = {\n  type: BiasType.GENDER,\n  level: BiasLevel.MEDIUM,\n  confidence: 0.75,\n  description: 'Potential gender bias detected',\n  affected_text: 'he should',\n  start_position: 0,\n  end_position: 9,\n  suggestions: [\n    'Use gender-neutral language',\n    'Consider \"they should\" instead'\n  ]\n};\n\nexport const mockAnalysisResult: AnalysisResult = {\n  text: 'He should be able to handle this role.',\n  language: 'en',\n  overall_bias_score: 0.65,\n  bias_level: BiasLevel.MEDIUM,\n  detections: [mockBiasDetection],\n  neutralized_text: 'They should be able to handle this role.',\n  processing_time: 1.2,\n  model_version: 'test-v1.0.0'\n};\n\nexport const mockHealthResponse: HealthResponse = {\n  status: 'healthy',\n  timestamp: '2023-12-02T10:00:00Z',\n  version: '1.0.0',\n  uptime: 3600,\n  dependencies: {\n    database: 'healthy',\n    ml_model: 'healthy'\n  }\n};\n\nexport const mockConfigResponse: ConfigResponse = {\n  app_name: 'BiasNeutralizeAI',\n  app_version: '1.0.0',\n  environment: 'test',\n  supported_languages: ['en', 'es', 'fr', 'de'],\n  supported_bias_types: [\n    BiasType.GENDER,\n    BiasType.RACIAL,\n    BiasType.AGE,\n    BiasType.RELIGIOUS,\n    BiasType.POLITICAL\n  ],\n  cultural_profiles: ['neutral', 'western', 'eastern', 'global'],\n  analysis_modes: ['fast', 'accurate', 'comprehensive'],\n  default_settings: {\n    confidence_threshold: 0.3,\n    include_suggestions: true,\n    cultural_profile: 'neutral',\n    analysis_mode: 'fast'\n  }\n};\n\n// Default MSW handlers\nexport const defaultHandlers = [\n  // Analysis endpoints\n  rest.post(`${API_BASE_URL}/api/v1/analyze`, (req, res, ctx) => {\n    return res(ctx.delay(1000), ctx.json(mockAnalysisResult));\n  }),\n\n  rest.post(`${API_BASE_URL}/api/v1/analyze/batch`, (req, res, ctx) => {\n    return res(ctx.delay(2000), ctx.json({\n      results: [mockAnalysisResult],\n      total_processed: 1,\n      total_processing_time: 1.2,\n      summary: {\n        total_detections: 1,\n        average_bias_score: 0.65,\n        texts_with_bias: 1,\n        success_rate: 1\n      }\n    }));\n  }),\n\n  // System endpoints\n  rest.get(`${API_BASE_URL}/api/v1/health`, (req, res, ctx) => {\n    return res(ctx.json(mockHealthResponse));\n  }),\n\n  rest.get(`${API_BASE_URL}/api/v1/config`, (req, res, ctx) => {\n    return res(ctx.json(mockConfigResponse));\n  }),\n\n  rest.get(`${API_BASE_URL}/api/v1/models`, (req, res, ctx) => {\n    return res(ctx.json({\n      models: [\n        {\n          name: 'bias-detection-v1',\n          version: '1.0.0',\n          description: 'Primary bias detection model',\n          supported_languages: ['en', 'es', 'fr'],\n          supported_bias_types: [BiasType.GENDER, BiasType.RACIAL],\n          accuracy: 0.89,\n          is_default: true,\n          loaded: true\n        }\n      ],\n      default_model: 'bias-detection-v1',\n      total_models: 1\n    }));\n  })\n];\n\n// Error scenario handlers\nexport const errorHandlers = {\n  networkError: rest.post(`${API_BASE_URL}/api/v1/analyze`, (req, res) => {\n    return res.networkError('Network connection failed');\n  }),\n\n  serverError: rest.post(`${API_BASE_URL}/api/v1/analyze`, (req, res, ctx) => {\n    return res(\n      ctx.status(500),\n      ctx.json({\n        detail: 'Internal server error',\n        error: 'ANALYSIS_FAILED'\n      })\n    );\n  }),\n\n  validationError: rest.post(`${API_BASE_URL}/api/v1/analyze`, (req, res, ctx) => {\n    return res(\n      ctx.status(400),\n      ctx.json({\n        detail: 'Validation error',\n        error: 'INVALID_INPUT'\n      })\n    );\n  }),\n\n  rateLimitError: rest.post(`${API_BASE_URL}/api/v1/analyze`, (req, res, ctx) => {\n    return res(\n      ctx.status(429),\n      ctx.json({\n        detail: 'Rate limit exceeded',\n        error: 'RATE_LIMIT'\n      })\n    );\n  })\n};\n\n// Create test server\nexport const createTestServer = (handlers = defaultHandlers) => {\n  return setupServer(...handlers);\n};\n\n// Create test query client\nexport const createTestQueryClient = () => {\n  return new QueryClient({\n    defaultOptions: {\n      queries: {\n        retry: false,\n        gcTime: 0,\n      },\n      mutations: {\n        retry: false,\n        gcTime: 0,\n      },\n    },\n    logger: {\n      log: () => {},\n      warn: () => {},\n      error: () => {},\n    },\n  });\n};\n\n// Test utilities\nexport const waitForApiCall = (ms = 100) => {\n  return new Promise(resolve => setTimeout(resolve, ms));\n};\n\nexport const createMockAnalysisRequest = (overrides = {}) => {\n  return {\n    text: 'Sample text for analysis',\n    mode: 'fast',\n    cultural_profile: 'neutral',\n    language: 'auto',\n    include_suggestions: true,\n    ...overrides\n  };\n};\n\n// Custom render function for React Query components\nexport const createWrapper = (queryClient?: QueryClient) => {\n  const client = queryClient || createTestQueryClient();\n\n  return ({ children }: { children: React.ReactNode }) => (\n    <QueryClientProvider client={client}>\n      {children}\n    </QueryClientProvider>\n  );\n};\n\n// Performance testing utilities\nexport const measureRenderTime = async (renderFn: () => void) => {\n  const start = performance.now();\n  renderFn();\n  await waitForApiCall(); // Wait for render to complete\n  const end = performance.now();\n  return end - start;\n};\n\n// Mock successful and failed network conditions\nexport const mockNetworkConditions = {\n  fast: { delay: 50 },\n  slow: { delay: 2000 },\n  unstable: {\n    delay: () => Math.random() * 1000 + 500,\n    failure: 0.1 // 10% failure rate\n  }\n};\n\nexport default {\n  createTestServer,\n  createTestQueryClient,\n  createWrapper,\n  defaultHandlers,\n  errorHandlers,\n  mockAnalysisResult,\n  mockHealthResponse,\n  mockConfigResponse\n};